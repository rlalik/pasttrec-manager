The pasttrec-manager is a Django database application to store and manage parameters for PASTTREC chips working within TRBnet.

It is regular Django application and it can be installed, e.g. using `pip` inside other Django site. However, the repository provides simple `demo` site which allows to run and test the pasttrec manager.

# Installation

There is no extra installation process that cloning the application from remote repository. The application requires several dependencies listed in `requirements.txt` file. They can be installed using `pip` with:
```bash
pip install -r requirements.txt
```

It is recommend to use local virtual environment independently from deploment type. The full chain of commands is following:
```bash
virtualenv venv
. venv/bin/activate
pip install -r requirements.txt
```

# Deployment

There are several ways to deploy the application:
* using web server like apache or nginx and appropriate python provider,
* integrate into existing django site,
* using local test server.

The latter one is the best option to run database locally. Whenever the remote access is required, the regular web server might be the best option. Before deploying the application as (not only public) web framework it is worth to read https://docs.djangoproject.com/en/dev/howto/deployment/. The exact way to deploy the application may depend on the server system thus is not covered in details in this manual.

## Security

The default configuration requires certain actions to allow to start local deployment. The `demo/settings.py` contains three variables which are required to be handled:
* `SECRET_KEY` - more at https://docs.djangoproject.com/en/dev/ref/settings/#secret-key
* `DEBUG` - more at https://docs.djangoproject.com/en/dev/ref/settings/#debug
* `ALLOWED_HOSTS` - https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts

The `SECRET_KEY` must be set to run the app. It was automatically generated by the django startapp command. It should not be used when deploying the app as public service.

The `demo` app can be used as a base for target deployment (public) application. If the demo app is used, the whole `demo` directory should be copied/renamed and sensitive parts removed from the repository tracking. Further separation between development/production environment may be required. One can read more about a such separation e.g. here: https://dzone.com/articles/django-settings-production-and The exact solution may depend on the server configuration and admin decisions. One can study this topic by searching keywords: `Django Settings for Production and Development`.

## Local server

This deployment method uses the provided `demo` application. After installing the dependencies, one has to execute following steps (it assumes that the virtual environment, if used for installation, is also active now):
1. Create superuser account:
	```bash
	./manage.py createsuperuser
	```
	The application will ask for new user name, the password, optionally also e-mail. This will be the super user account, having full permission. If the site may be available in the network, one should take care about safe password. The application does not impose any requirements according to the password quality.
1. Prepare the database by preparing and applying migrations:
	```bash
	./manage.py makemigrations
	./manage.py migrate
	```
	This will prepare and apply database queries (SQL queries) to create the database. The default will be sqlite database. User can change the database using `demo/settings.py`.
1. Run the test server
	```bash
	./manage runserver
	```
	This will start server at `localhost:8000`. If the default pot `8000` is busy, one can provide another port number, e.g.
	```bash
	./manage runserver 8888
	```
	See also `--help` for more details.

## Integrating with existing django site

This allow to use existing site (either local or server-based) as a base system. In the target application one has to add appropriate settings. Most of the required settings can be lookup in the `demo/settings.py` and `demo/urls.py`L
1. Installed apps

	Check the `demo/settings.py` for the `INSTALLED_APPS` settings. Required application are listed after `# extra apps` comment. The same application should be present in the target site.
	
1. Configure url

	In the main `urls.py` one has to add a path to the manager application. An example entry may look like this:
	```python3
	urlpatterns = [
		# other sites...
		path("manager/", include("django_pasttrec_manager.urls", namespace="django_pasttrec_manager")),
	]
	```